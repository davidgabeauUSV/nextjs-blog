{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\n\nvar _this = this,\n    _jsxFileName = \"/Users/davidgabeau/Desktop/glo/nextjs-blog/with-magic-app/pages/login.js\";\n\nimport _JSXStyle from \"styled-jsx/style\";\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport { useState } from 'react';\nimport Router from 'next/router';\nimport { useUser } from '../lib/hooks';\nimport Layout from '../components/layout';\nimport Form from '../components/form';\nimport { Magic } from 'magic-sdk';\n\nvar Login = function Login() {\n  useUser({\n    redirectTo: '/',\n    redirectIfFound: true\n  });\n\n  var _useState = useState(''),\n      errorMsg = _useState[0],\n      setErrorMsg = _useState[1];\n\n  function handleSubmit(e) {\n    var body, magic, didToken, res;\n    return _regeneratorRuntime.async(function handleSubmit$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            event.preventDefault();\n            if (errorMsg) setErrorMsg('');\n            body = {\n              email: e.currentTarget.email.value\n            };\n            _context.prev = 3;\n            magic = new Magic(process.env.MAGIC_PUBLISHABLE_KEY);\n            _context.next = 7;\n            return _regeneratorRuntime.awrap(magic.auth.loginWithMagicLink({\n              email: body.email\n            }));\n\n          case 7:\n            didToken = _context.sent;\n            _context.next = 10;\n            return _regeneratorRuntime.awrap(fetch('/api/login', {\n              method: 'POST',\n              headers: {\n                'Content-Type': 'application/json',\n                Authorization: 'Bearer ' + didToken\n              },\n              body: JSON.stringify(body)\n            }));\n\n          case 10:\n            res = _context.sent;\n\n            if (!(res.status === 200)) {\n              _context.next = 15;\n              break;\n            }\n\n            Router.push('/');\n            _context.next = 20;\n            break;\n\n          case 15:\n            _context.t0 = Error;\n            _context.next = 18;\n            return _regeneratorRuntime.awrap(res.text());\n\n          case 18:\n            _context.t1 = _context.sent;\n            throw new _context.t0(_context.t1);\n\n          case 20:\n            _context.next = 26;\n            break;\n\n          case 22:\n            _context.prev = 22;\n            _context.t2 = _context[\"catch\"](3);\n            console.error('An unexpected error happened occurred:', _context.t2);\n            setErrorMsg(_context.t2.message);\n\n          case 26:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, [[3, 22]], Promise);\n  }\n\n  return __jsx(Layout, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 48,\n      columnNumber: 5\n    }\n  }, __jsx(\"div\", {\n    className: \"jsx-324748941\" + \" \" + \"login\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 49,\n      columnNumber: 7\n    }\n  }, __jsx(Form, {\n    errorMessage: errorMsg,\n    onSubmit: handleSubmit,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 50,\n      columnNumber: 9\n    }\n  })), __jsx(_JSXStyle, {\n    id: \"324748941\",\n    __self: _this\n  }, \".login.jsx-324748941{max-width:21rem;margin:0 auto;padding:1rem;border:1px solid #ccc;border-radius:4px;}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9kYXZpZGdhYmVhdS9EZXNrdG9wL2dsby9uZXh0anMtYmxvZy93aXRoLW1hZ2ljLWFwcC9wYWdlcy9sb2dpbi5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFtRGtCLEFBRzJCLGdCQUNGLGNBQ0QsYUFDUyxzQkFDSixrQkFDcEIiLCJmaWxlIjoiL1VzZXJzL2RhdmlkZ2FiZWF1L0Rlc2t0b3AvZ2xvL25leHRqcy1ibG9nL3dpdGgtbWFnaWMtYXBwL3BhZ2VzL2xvZ2luLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgdXNlU3RhdGUgfSBmcm9tICdyZWFjdCdcbmltcG9ydCBSb3V0ZXIgZnJvbSAnbmV4dC9yb3V0ZXInXG5pbXBvcnQgeyB1c2VVc2VyIH0gZnJvbSAnLi4vbGliL2hvb2tzJ1xuaW1wb3J0IExheW91dCBmcm9tICcuLi9jb21wb25lbnRzL2xheW91dCdcbmltcG9ydCBGb3JtIGZyb20gJy4uL2NvbXBvbmVudHMvZm9ybSdcblxuaW1wb3J0IHsgTWFnaWMgfSBmcm9tICdtYWdpYy1zZGsnXG5cbmNvbnN0IExvZ2luID0gKCkgPT4ge1xuICB1c2VVc2VyKHsgcmVkaXJlY3RUbzogJy8nLCByZWRpcmVjdElmRm91bmQ6IHRydWUgfSlcblxuICBjb25zdCBbZXJyb3JNc2csIHNldEVycm9yTXNnXSA9IHVzZVN0YXRlKCcnKVxuXG4gIGFzeW5jIGZ1bmN0aW9uIGhhbmRsZVN1Ym1pdChlKSB7XG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKVxuXG4gICAgaWYgKGVycm9yTXNnKSBzZXRFcnJvck1zZygnJylcblxuICAgIGNvbnN0IGJvZHkgPSB7XG4gICAgICBlbWFpbDogZS5jdXJyZW50VGFyZ2V0LmVtYWlsLnZhbHVlLFxuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICBjb25zdCBtYWdpYyA9IG5ldyBNYWdpYyhwcm9jZXNzLmVudi5NQUdJQ19QVUJMSVNIQUJMRV9LRVkpXG4gICAgICBjb25zdCBkaWRUb2tlbiA9IGF3YWl0IG1hZ2ljLmF1dGgubG9naW5XaXRoTWFnaWNMaW5rKHtcbiAgICAgICAgZW1haWw6IGJvZHkuZW1haWwsXG4gICAgICB9KVxuICAgICAgY29uc3QgcmVzID0gYXdhaXQgZmV0Y2goJy9hcGkvbG9naW4nLCB7XG4gICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgICBBdXRob3JpemF0aW9uOiAnQmVhcmVyICcgKyBkaWRUb2tlbixcbiAgICAgICAgfSxcbiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoYm9keSksXG4gICAgICB9KVxuICAgICAgaWYgKHJlcy5zdGF0dXMgPT09IDIwMCkge1xuICAgICAgICBSb3V0ZXIucHVzaCgnLycpXG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYXdhaXQgcmVzLnRleHQoKSlcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignQW4gdW5leHBlY3RlZCBlcnJvciBoYXBwZW5lZCBvY2N1cnJlZDonLCBlcnJvcilcbiAgICAgIHNldEVycm9yTXNnKGVycm9yLm1lc3NhZ2UpXG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIChcbiAgICA8TGF5b3V0PlxuICAgICAgPGRpdiBjbGFzc05hbWU9XCJsb2dpblwiPlxuICAgICAgICA8Rm9ybSBlcnJvck1lc3NhZ2U9e2Vycm9yTXNnfSBvblN1Ym1pdD17aGFuZGxlU3VibWl0fSAvPlxuICAgICAgPC9kaXY+XG4gICAgICA8c3R5bGUganN4PntgXG4gICAgICAgIC5sb2dpbiB7XG4gICAgICAgICAgbWF4LXdpZHRoOiAyMXJlbTtcbiAgICAgICAgICBtYXJnaW46IDAgYXV0bztcbiAgICAgICAgICBwYWRkaW5nOiAxcmVtO1xuICAgICAgICAgIGJvcmRlcjogMXB4IHNvbGlkICNjY2M7XG4gICAgICAgICAgYm9yZGVyLXJhZGl1czogNHB4O1xuICAgICAgICB9XG4gICAgICBgfTwvc3R5bGU+XG4gICAgPC9MYXlvdXQ+XG4gIClcbn1cblxuZXhwb3J0IGRlZmF1bHQgTG9naW5cbiJdfQ== */\\n/*@ sourceURL=/Users/davidgabeau/Desktop/glo/nextjs-blog/with-magic-app/pages/login.js */\"));\n};\n\nexport default Login;","map":{"version":3,"sources":["/Users/davidgabeau/Desktop/glo/nextjs-blog/with-magic-app/pages/login.js"],"names":["useState","Router","useUser","Layout","Form","Magic","Login","redirectTo","redirectIfFound","errorMsg","setErrorMsg","handleSubmit","e","event","preventDefault","body","email","currentTarget","value","magic","process","env","MAGIC_PUBLISHABLE_KEY","auth","loginWithMagicLink","didToken","fetch","method","headers","Authorization","JSON","stringify","res","status","push","Error","text","console","error","message"],"mappings":";;;;;;;;AAAA,SAASA,QAAT,QAAyB,OAAzB;AACA,OAAOC,MAAP,MAAmB,aAAnB;AACA,SAASC,OAAT,QAAwB,cAAxB;AACA,OAAOC,MAAP,MAAmB,sBAAnB;AACA,OAAOC,IAAP,MAAiB,oBAAjB;AAEA,SAASC,KAAT,QAAsB,WAAtB;;AAEA,IAAMC,KAAK,GAAG,SAARA,KAAQ,GAAM;AAClBJ,EAAAA,OAAO,CAAC;AAAEK,IAAAA,UAAU,EAAE,GAAd;AAAmBC,IAAAA,eAAe,EAAE;AAApC,GAAD,CAAP;;AADkB,kBAGcR,QAAQ,CAAC,EAAD,CAHtB;AAAA,MAGXS,QAHW;AAAA,MAGDC,WAHC;;AAKlB,WAAeC,YAAf,CAA4BC,CAA5B;AAAA;AAAA;AAAA;AAAA;AAAA;AACEC,YAAAA,KAAK,CAACC,cAAN;AAEA,gBAAIL,QAAJ,EAAcC,WAAW,CAAC,EAAD,CAAX;AAERK,YAAAA,IALR,GAKe;AACXC,cAAAA,KAAK,EAAEJ,CAAC,CAACK,aAAF,CAAgBD,KAAhB,CAAsBE;AADlB,aALf;AAAA;AAUUC,YAAAA,KAVV,GAUkB,IAAId,KAAJ,CAAUe,OAAO,CAACC,GAAR,CAAYC,qBAAtB,CAVlB;AAAA;AAAA,6CAW2BH,KAAK,CAACI,IAAN,CAAWC,kBAAX,CAA8B;AACnDR,cAAAA,KAAK,EAAED,IAAI,CAACC;AADuC,aAA9B,CAX3B;;AAAA;AAWUS,YAAAA,QAXV;AAAA;AAAA,6CAcsBC,KAAK,CAAC,YAAD,EAAe;AACpCC,cAAAA,MAAM,EAAE,MAD4B;AAEpCC,cAAAA,OAAO,EAAE;AACP,gCAAgB,kBADT;AAEPC,gBAAAA,aAAa,EAAE,YAAYJ;AAFpB,eAF2B;AAMpCV,cAAAA,IAAI,EAAEe,IAAI,CAACC,SAAL,CAAehB,IAAf;AAN8B,aAAf,CAd3B;;AAAA;AAcUiB,YAAAA,GAdV;;AAAA,kBAsBQA,GAAG,CAACC,MAAJ,KAAe,GAtBvB;AAAA;AAAA;AAAA;;AAuBMhC,YAAAA,MAAM,CAACiC,IAAP,CAAY,GAAZ;AAvBN;AAAA;;AAAA;AAAA,0BAyBgBC,KAzBhB;AAAA;AAAA,6CAyB4BH,GAAG,CAACI,IAAJ,EAzB5B;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AA4BIC,YAAAA,OAAO,CAACC,KAAR,CAAc,wCAAd;AACA5B,YAAAA,WAAW,CAAC,YAAM6B,OAAP,CAAX;;AA7BJ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAiCA,SACE,MAAC,MAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE;AAAA,uCAAe,OAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,MAAC,IAAD;AAAM,IAAA,YAAY,EAAE9B,QAApB;AAA8B,IAAA,QAAQ,EAAEE,YAAxC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADF,CADF;AAAA;AAAA;AAAA,svFADF;AAgBD,CAtDD;;AAwDA,eAAeL,KAAf","sourcesContent":["import { useState } from 'react'\nimport Router from 'next/router'\nimport { useUser } from '../lib/hooks'\nimport Layout from '../components/layout'\nimport Form from '../components/form'\n\nimport { Magic } from 'magic-sdk'\n\nconst Login = () => {\n  useUser({ redirectTo: '/', redirectIfFound: true })\n\n  const [errorMsg, setErrorMsg] = useState('')\n\n  async function handleSubmit(e) {\n    event.preventDefault()\n\n    if (errorMsg) setErrorMsg('')\n\n    const body = {\n      email: e.currentTarget.email.value,\n    }\n\n    try {\n      const magic = new Magic(process.env.MAGIC_PUBLISHABLE_KEY)\n      const didToken = await magic.auth.loginWithMagicLink({\n        email: body.email,\n      })\n      const res = await fetch('/api/login', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          Authorization: 'Bearer ' + didToken,\n        },\n        body: JSON.stringify(body),\n      })\n      if (res.status === 200) {\n        Router.push('/')\n      } else {\n        throw new Error(await res.text())\n      }\n    } catch (error) {\n      console.error('An unexpected error happened occurred:', error)\n      setErrorMsg(error.message)\n    }\n  }\n\n  return (\n    <Layout>\n      <div className=\"login\">\n        <Form errorMessage={errorMsg} onSubmit={handleSubmit} />\n      </div>\n      <style jsx>{`\n        .login {\n          max-width: 21rem;\n          margin: 0 auto;\n          padding: 1rem;\n          border: 1px solid #ccc;\n          border-radius: 4px;\n        }\n      `}</style>\n    </Layout>\n  )\n}\n\nexport default Login\n"]},"metadata":{},"sourceType":"module"}